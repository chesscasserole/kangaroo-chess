<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Variant - Piece Swapping</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .chessboard {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 0;
            margin: 20px auto;
            border: 2px solid #333;
        }
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            user-select: none;
        }
        .square.light {
            background-color: #f0d9b5;
        }
        .square.dark {
            background-color: #b58863;
        }
        .square:hover {
            opacity: 0.8;
        }
        .current-player {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .rules {
            max-width: 600px;
            margin-top: 20px;
            text-align: left;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
        }
        .rules h3 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Chess Variant: Piece Swapping</h1>
        <div class="current-player" id="currentPlayer">Current Player: White</div>
        <div class="chessboard" id="chessboard"></div>
        
        <div class="rules">
            <h3>Rules:</h3>
            <ul>
                <li>All pieces move according to standard chess rules</li>
                <li><strong>Special Rule:</strong> You can swap positions with your own pieces instead of moving normally</li>
                <li>You cannot swap with opponent pieces - only capture them</li>
                <li>Win by capturing the opponent's king</li>
                <li>Click a piece to select it, then click where you want to move/swap</li>
            </ul>
        </div>
    </div>

    <script>
        let selectedSquare = null;
        let gameBoard = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];
        let currentPlayer = 'white';
        let gameOver = false;

        const pieceSymbols = {
            'K': '♔', 'Q': '♕', 'R': '♖', 'B': '♗', 'N': '♘', 'P': '♙',
            'k': '♚', 'q': '♛', 'r': '♜', 'b': '♝', 'n': '♞', 'p': '♟'
        };

        function createBoard() {
            const board = document.getElementById('chessboard');
            board.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    square.dataset.row = row;
                    square.dataset.col = col;
                    square.addEventListener('click', () => handleSquareClick(row, col));
                    board.appendChild(square);
                }
            }
        }

        function renderBoard() {
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    const piece = gameBoard[row][col];
                    square.textContent = piece ? pieceSymbols[piece] : '';
                }
            }
            
            const playerDisplay = document.getElementById('currentPlayer');
            if (gameOver) {
                playerDisplay.textContent = 'Game Over!';
            } else {
                playerDisplay.textContent = `Current Player: ${currentPlayer.charAt(0).toUpperCase() + currentPlayer.slice(1)}`;
            }
        }

        function handleSquareClick(row, col) {
            if (gameOver) return; // Don't allow moves if game is over

            if (selectedSquare) {
                // Try to make a move
                if (canMoveTo(selectedSquare.row, selectedSquare.col, row, col)) {
                    makeMove(selectedSquare.row, selectedSquare.col, row, col);
                }
                selectedSquare = null;
            } else {
                // Select a piece
                const piece = gameBoard[row][col];
                if (piece && isPlayerPiece(piece, currentPlayer)) {
                    selectedSquare = { row, col };
                }
            }
        }

        function isPlayerPiece(piece, player) {
            if (player === 'white') {
                return piece === piece.toUpperCase();
            } else {
                return piece === piece.toLowerCase();
            }
        }

        function canMoveTo(fromRow, fromCol, toRow, toCol) {
            const piece = gameBoard[fromRow][fromCol];
            const targetPiece = gameBoard[toRow][toCol];

            // Can't move to same square
            if (fromRow === toRow && fromCol === toCol) return false;

            // Can swap with your own pieces
            if (targetPiece && isPlayerPiece(piece, currentPlayer) && isPlayerPiece(targetPiece, currentPlayer)) {
                return true;
            }

            // Can't move to a square with your own piece (except swapping case above)
            if (targetPiece && isPlayerPiece(piece, currentPlayer) && isPlayerPiece(targetPiece, currentPlayer)) {
                return false;
            }

            // Can't capture your own pieces if they're not swapping
            if (targetPiece && isPlayerPiece(piece, currentPlayer) === isPlayerPiece(targetPiece, currentPlayer)) {
                return false;
            }

            return isValidMove(piece, fromRow, fromCol, toRow, toCol);
        }

        function makeMove(fromRow, fromCol, toRow, toCol) {
            const piece = gameBoard[fromRow][fromCol];
            const targetPiece = gameBoard[toRow][toCol];

            // Check if capturing the king
            if (targetPiece && (targetPiece.toLowerCase() === 'k') && !isPlayerPiece(targetPiece, currentPlayer)) {
                gameOver = true;
                const winnerColor = currentPlayer;
                setTimeout(() => {
                    alert(`${winnerColor.charAt(0).toUpperCase() + winnerColor.slice(1)} wins by capturing the king!`);
                }, 100);
            }

            // Check if it's a swap with own piece
            if (targetPiece && isPlayerPiece(piece, currentPlayer) && isPlayerPiece(targetPiece, currentPlayer)) {
                // Swap pieces
                gameBoard[fromRow][fromCol] = targetPiece;
                gameBoard[toRow][toCol] = piece;
            } else {
                // Normal move or capture
                gameBoard[toRow][toCol] = piece;
                gameBoard[fromRow][fromCol] = null;
            }

            if (!gameOver) {
                currentPlayer = currentPlayer === 'white' ? 'black' : 'white';
            }
            renderBoard();
        }

        function isValidMove(piece, fromRow, fromCol, toRow, toCol) {
            const deltaRow = toRow - fromRow;
            const deltaCol = toCol - fromCol;
            const absDeltaRow = Math.abs(deltaRow);
            const absDeltaCol = Math.abs(deltaCol);

            switch (piece.toLowerCase()) {
                case 'p': // Pawn
                    const direction = piece === 'P' ? -1 : 1;
                    const startRow = piece === 'P' ? 6 : 1;
                    
                    // Forward move
                    if (deltaCol === 0) {
                        if (deltaRow === direction && !gameBoard[toRow][toCol]) return true;
                        if (fromRow === startRow && deltaRow === 2 * direction && !gameBoard[toRow][toCol]) return true;
                    }
                    // Diagonal capture
                    else if (absDeltaCol === 1 && deltaRow === direction && gameBoard[toRow][toCol]) {
                        return true;
                    }
                    return false;

                case 'r': // Rook
                    if (deltaRow === 0 || deltaCol === 0) {
                        return isPathClear(fromRow, fromCol, toRow, toCol);
                    }
                    return false;

                case 'b': // Bishop
                    if (absDeltaRow === absDeltaCol) {
                        return isPathClear(fromRow, fromCol, toRow, toCol);
                    }
                    return false;

                case 'q': // Queen
                    if (deltaRow === 0 || deltaCol === 0 || absDeltaRow === absDeltaCol) {
                        return isPathClear(fromRow, fromCol, toRow, toCol);
                    }
                    return false;

                case 'k': // King
                    return absDeltaRow <= 1 && absDeltaCol <= 1;

                case 'n': // Knight
                    return (absDeltaRow === 2 && absDeltaCol === 1) || (absDeltaRow === 1 && absDeltaCol === 2);

                default:
                    return false;
            }
        }

        function isPathClear(fromRow, fromCol, toRow, toCol) {
            const rowDir = toRow > fromRow ? 1 : toRow < fromRow ? -1 : 0;
            const colDir = toCol > fromCol ? 1 : toCol < fromCol ? -1 : 0;
            
            let currentRow = fromRow + rowDir;
            let currentCol = fromCol + colDir;
            
            while (currentRow !== toRow || currentCol !== toCol) {
                if (gameBoard[currentRow][currentCol] !== null) return false;
                currentRow += rowDir;
                currentCol += colDir;
            }
            
            return true;
        }

        // Initialize the game
        createBoard();
        renderBoard();
    </script>
</body>
</html>
